<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>任务管理 PWA 界面微调</title>
  <style>
    /* 控制区样式 */
    .controls {
      display: flex;
      flex-direction: column; /* 输入框纵向排列:contentReference[oaicite:9]{index=9} */
      gap: 8px;  /* 输入框之间适当间距 */
      max-width: 400px; /* 可选：限制控制区宽度 */
      margin-bottom: 16px;
    }
    .controls input {
      font-size: 14px;
      padding: 4px;
      /* 宽度保持原样，如需全宽可设为 width: 100%; */
    }
    .controls button {
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }

    /* 任务列表和卡片样式 */
    .task-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .task-item {
      display: flex;
      align-items: flex-start;  /* 手柄与卡片顶端对齐 */
      margin-bottom: 8px;
    }
    .task-card {
      position: relative;  /* 相对定位，以放置绝对定位的按钮 */
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 8px;
      flex: 1;  /* 占据剩余空间 */
      min-height: 40px;
    }
    .task-card .title {
      font-weight: bold;
    }
    .task-card .remark {
      margin-top: 4px;
      font-size: 13px;
      color: #333;
      /* 默认隐藏由JS控制，这里可选地设定动画过渡效果 */
      transition: max-height 0.2s ease;
    }

    /* 小圆按钮通用样式 */
    .btn-circle {
      width: 12px;
      height: 12px;
      border: none;
      border-radius: 50%;  /* 圆形按钮:contentReference[oaicite:10]{index=10} */
      cursor: pointer;
      padding: 0;
    }
    /* 蓝色展开按钮 */
    .expand-btn {
      background: #2196F3; /* 蓝色 */
      position: absolute;
      top: 5px;
      right: 5px;
    }
    /* 红色收起按钮 */
    .collapse-btn {
      background: #f44336; /* 红色 */
      position: absolute;
      bottom: 5px;
      right: 5px;
    }
    /* 灰色拖动手柄按钮 */
    .drag-handle {
      background: #ccc;
      color: #000;
      font-size: 12px;
      line-height: 12px;
      text-align: center;
      margin: 4px 8px 0 0; /* 与卡片间距 */
      cursor: move;  /* 鼠标悬停显示移动光标 */
    }
    .drag-handle:active {
      background: #bbb;
    }

    /* 隐藏元素的辅助样式（用于隐藏备注和按钮） */
    .hidden {
      display: none;
    }

    /* 拖动过程中的样式反馈 */
    .dragging {
      opacity: 0.5;
    }
  </style>
</head>
<body>

  <!-- 控制区：任务输入 -->
  <div class="controls">
    <input type="text" placeholder="任务标题" />
    <input type="text" placeholder="备注" />
    <button type="button">添加任务</button>
  </div>

  <!-- 任务列表 -->
  <ul class="task-list">
    <!-- 示例任务1（备注隐藏状态） -->
    <li class="task-item" id="task-1">
      <button class="drag-handle btn-circle" title="拖动排序">✥</button>
      <div class="task-card">
        <button class="expand-btn btn-circle"></button>
        <button class="collapse-btn btn-circle hidden"></button>
        <div class="title">示例任务 1</div>
        <div class="remark hidden">这是一段示例备注内容。</div>
      </div>
    </li>
    <!-- 示例任务2（可复制多份，演示多个任务项） -->
    <li class="task-item" id="task-2">
      <button class="drag-handle btn-circle" title="拖动排序">✥</button>
      <div class="task-card">
        <button class="expand-btn btn-circle"></button>
        <button class="collapse-btn btn-circle hidden"></button>
        <div class="title">示例任务 2</div>
        <div class="remark hidden">第二个任务的备注内容。</div>
      </div>
    </li>
  </ul>

  <script>
    // 功能脚本：备注展开/收起切换，拖动排序实现（仅通过手柄拖动）
    document.addEventListener('DOMContentLoaded', function() {
      // 备注展开/收起按钮事件绑定
      document.querySelectorAll('.expand-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const card = this.closest('.task-card');
          const remark = card.querySelector('.remark');
          const collapseBtn = card.querySelector('.collapse-btn');
          // 展开备注
          remark.classList.remove('hidden');
          this.classList.add('hidden');        // 隐藏蓝色按钮
          collapseBtn.classList.remove('hidden'); // 显示红色按钮
        });
      });
      document.querySelectorAll('.collapse-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const card = this.closest('.task-card');
          const remark = card.querySelector('.remark');
          const expandBtn = card.querySelector('.expand-btn');
          // 收起备注
          remark.classList.add('hidden');
          this.classList.add('hidden');       // 隐藏红色按钮
          expandBtn.classList.remove('hidden');  // 显示蓝色按钮
        });
      });

      // 拖动排序（Pointer Events实现）
      let draggingItem = null;
      let initialY = 0;
      document.querySelectorAll('.drag-handle').forEach(handle => {
        // 开始拖动：pointerdown 手柄
        handle.addEventListener('pointerdown', function(e) {
          draggingItem = this.closest('.task-item');
          initialY = e.clientY;
          draggingItem.classList.add('dragging');
          // 阻止默认事件以避免选中文本等
          e.preventDefault();
        });
      });
      // 拖动中：pointermove
      document.addEventListener('pointermove', function(e) {
        if (!draggingItem) return;
        const pointerY = e.clientY;
        // 检查是否需要和相邻项交换位置
        const prev = draggingItem.previousElementSibling;
        const next = draggingItem.nextElementSibling;
        if (prev && pointerY < prev.getBoundingClientRect().top + prev.getBoundingClientRect().height / 2) {
          // 与上一个元素交换位置（向上移动）
          draggingItem.parentNode.insertBefore(draggingItem, prev);
        } else if (next && pointerY > next.getBoundingClientRect().top + next.getBoundingClientRect().height / 2) {
          // 与下一个元素交换位置（向下移动）
          draggingItem.parentNode.insertBefore(next, draggingItem);
        }
      });
      // 拖动结束：pointerup
      document.addEventListener('pointerup', function() {
        if (draggingItem) {
          draggingItem.classList.remove('dragging');
          draggingItem = null;
        }
      });
    });
  </script>

</body>
</html>
